# A .sqlfluff file is used instead of .sqruff because it's supported by both sqruff and sqlfluff, and it's also better integrated with IDEs.
[sqlfluff]
dialect = postgres
max_line_length = 180
rules = all
# AM04 is excluded because sqlc automatically generates column names based on wildcards.
# CV11 is excluded because sqruff raises a lot of false positives when using sqlc functions.
exclude_rules = AM04, CV11

# AMBIGUITY
[sqlfluff:rules:ambiguous.column_references]
# GROUP BY/ORDER BY should explicitly reference the column names, not their positions.
group_by_and_order_by_style = explicit

# CAPITALISATION
[sqlfluff:rules:capitalisation.keywords]
capitalisation_policy = upper

[sqlfluff:rules:capitalisation.literals]
capitalisation_policy = upper

[sqlfluff:rules:capitalisation.identifiers]
extended_capitalisation_policy = lower

[sqlfluff:rules:capitalisation.types]
extended_capitalisation_policy = lower

[sqlfluff:rules:capitalisation.functions]
extended_capitalisation_policy = lower

# CONVENTION
[sqlfluff:rules:convention.not_equal]
# "!=" is preferred over "<>" for inequality checks.
preferred_not_equal_style = c_style

[sqlfluff:rules:convention.terminator]
require_final_semicolon = true

[sqlfluff:rules:convention.blocked_words]
# Comma separated list of blocked words that should not be used
# Both "bool" and "int" should be replaced by their full versions ("boolean" and "integer").
blocked_words = bool,int

[sqlfluff:rules:convention.quoted_literals]
# Postgres supports only single quotes for string literals.
preferred_quoted_literal_style = single_quotes

[sqlfluff:rules:convention.casting_style]
# "::" is preferred over "cast()".
preferred_type_casting_style = shorthand

# LAYOUT
[sqlfluff:layout:type:alias_expression]
# We want non-default spacing before the alias expressions.
spacing_before = align
# We want to align them within the next outer SELECT clause.
# This means for example that alias expressions within the FROM
# or JOIN clause will not be aligned with them.
align_within = select_clause
# The point at which to stop searching outward for siblings, which
# in this example would likely be the boundary of a CTE. Stopping
# when we hit brackets is usually a good rule of thumb for this
# configuration.
align_scope = bracketed

[sqlfluff:indentation]
# SQL queries can easily get quite nested, so an indent size of 2 (replacing the default of 4) is used to make things more legible.
tab_space_size = 2
indented_ctes = true

# Align nullabilities & types in CREATE/ALTER TABLE statements.
[sqlfluff:layout:type:data_type]
spacing_before = align
align_within = statement
align_scope = file

# REFERENCES
[sqlfluff:rules:references.keywords]
unquoted_identifiers_policy = table_aliases

# STRUCTURE
[sqlfluff:rules:structure.join_condition_order]
preferred_first_table_in_join_clause = later
